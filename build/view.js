!function(){"use strict";const t=function(){const t={supported:!0,missing:[]};return window.HTMLCanvasElement&&document.createElement("canvas").getContext||(t.supported=!1,t.missing.push("Canvas API")),window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout),window.sessionStorage||(window.sessionStorage={_data:{},getItem:function(t){return this._data[t]||null},setItem:function(t,e){this._data[t]=String(e)},removeItem:function(t){delete this._data[t]}}),window.addEventListener||(t.supported=!1,t.missing.push("Event Listeners")),Array.prototype.forEach&&Array.prototype.indexOf||(t.supported=!1,t.missing.push("ES5 Array Methods")),window.performance&&window.performance.now||(window.performance||(window.performance={}),window.performance.now=function(){return Date.now()}),t}();if(!t.supported){function r(){document.querySelectorAll(".wp-block-glitter-bomb-glitter-bomb").forEach(function(e){e.querySelector(".glitter-bomb-fallback")||function(t,e){const i=document.createElement("div");i.className="glitter-bomb-fallback",i.style.cssText='padding: 20px; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); border-radius: 12px; color: #ffffff; text-align: center; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;';const o=document.createElement("h3");o.style.cssText="margin: 0 0 12px 0; font-size: 20px;",o.appendChild(document.createTextNode("✨ Glitter Bomb ✨")),i.appendChild(o);const s=document.createElement("p");s.style.cssText="margin: 0 0 12px 0; font-size: 14px;",s.appendChild(document.createTextNode("Your browser doesn't support the features needed for particle effects.")),i.appendChild(s);const a=document.createElement("p");a.style.cssText="margin: 0; font-size: 12px; opacity: 0.9;",a.appendChild(document.createTextNode("Missing: ")),a.appendChild(document.createTextNode(e.join(", "))),i.appendChild(a);const n=document.createElement("p");n.style.cssText="margin: 12px 0 0 0; font-size: 12px; opacity: 0.8;",n.appendChild(document.createTextNode("Please update to a modern browser for the best experience.")),i.appendChild(n),t.appendChild(i)}(e,t.missing)})}return console.warn("Glitter Bomb: Browser not supported. Missing features:",t.missing),void("loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r())}const e=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768,o=1e3/60;class s{constructor(t){t=t||100,this.pool=[],this.activeParticles=[];for(let e=0;e<t;e++)this.pool.push(this.createParticleObject())}createParticleObject(){return{x:0,y:0,homX:0,homY:0,vx:0,vy:0,baseSize:0,size:0,opacity:0,color:"",birthTime:0,maxLife:0,shimmerPhase:0,shimmerSpeed:0,rotation:0,rotationSpeed:0,colorIndex:0,colorCycleSpeed:0,isExplosion:!1,explosionLife:0,driftAngle:0,driftSpeed:0,driftPhase:0,active:!1}}acquire(){let t;return t=this.pool.length>0?this.pool.pop():this.createParticleObject(),t.active=!0,this.activeParticles.push(t),t}release(t){const e=this.activeParticles.indexOf(t);e>-1&&this.activeParticles.splice(e,1),t.active=!1,this.pool.push(t)}releaseAll(){for(;this.activeParticles.length>0;){const t=this.activeParticles.pop();t.active=!1,this.pool.push(t)}}getActive(){return this.activeParticles}getPoolSize(){return this.pool.length}getActiveCount(){return this.activeParticles.length}}class a{constructor(t){this.blockElement=t,this.canvas=null,this.ctx=null,this.particlePool=null,this.isActive=!1,this.animationFrameId=null,this.lastFrameTime=0,this.lastUpdateTime=0,this.lastTouchX=0,this.lastTouchY=0,this.paletteIndex=0,this.mouseX=window.innerWidth/2,this.mouseY=window.innerHeight/2,this.mouseInViewport=!1,this.isTabVisible=!document.hidden,this.lastParticleX=0,this.lastParticleY=0,this.isInitialized=!1,this.rockets=[],this.rocketLaunchTimer=0,this.lastTouchTime=0,this.canvasScale=1,this.logicalWidth=0,this.logicalHeight=0,this.isResizing=!1,this.resizeDebounceTimer=null,this.lastResizeTime=0,this.canvasOpacity=1,this.targetOpacity=1,this.isFading=!1,this.config={experienceMode:t.dataset.experienceMode||"particle-field",colorPalette:t.dataset.colorPalette||"rainbow-cycling",particleOpacity:parseFloat(t.dataset.particleOpacity)||.9,particleSize:parseFloat(t.dataset.particleSize)||10,particleSizeMobile:parseFloat(t.dataset.particleSizeMobile)||7.5,animationDuration:parseInt(t.dataset.animationDuration)||1500,enableButtonText:t.dataset.enableButtonText||"✨ Enable Sparkles",disableButtonText:t.dataset.disableButtonText||"✨ Disable Sparkles",buttonPosition:t.dataset.buttonPosition||"bottom-right",customColor:t.dataset.customColor||"#ff69b4",maxParticles:parseInt(t.dataset.maxParticles)||50,enabledByDefault:"true"===t.dataset.enabledByDefault,enableButtonTextColor:t.dataset.enableButtonTextColor||"#ffffff",enableButtonBgColor:t.dataset.enableButtonBgColor||"#667eea",enableButtonGradientStart:t.dataset.enableButtonGradientStart||"",enableButtonGradientEnd:t.dataset.enableButtonGradientEnd||"",disableButtonTextColor:t.dataset.disableButtonTextColor||"#ffffff",disableButtonBgColor:t.dataset.disableButtonBgColor||"#f093fb",disableButtonGradientStart:t.dataset.disableButtonGradientStart||"",disableButtonGradientEnd:t.dataset.disableButtonGradientEnd||"",displayBehavior:t.dataset.displayBehavior||"compact",fieldColorPalette:t.dataset.fieldColorPalette||"metallic",fieldParticleCount:parseInt(t.dataset.fieldParticleCount)||200,fieldParticleSize:parseFloat(t.dataset.fieldParticleSize)||6,fieldParticleSizeMobile:parseFloat(t.dataset.fieldParticleSizeMobile)||3,fieldMouseAttraction:parseFloat(t.dataset.fieldMouseAttraction)||.5,fieldSpreadStrength:parseFloat(t.dataset.fieldSpreadStrength)||.3,fieldClickExplosion:"true"===t.dataset.fieldClickExplosion,fieldParticleStyle:t.dataset.fieldParticleStyle||"glitter",sprinkleStyle:t.dataset.sprinkleStyle||"particles",sprinkleEmoji:t.dataset.sprinkleEmoji||"✨",disableOnMobile:"true"===t.dataset.disableOnMobile},this.colorPalettes={"rainbow-cycling":["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"],metallic:["#C0C0C0","#D4AF37","#E5E4E2","#B87333","#AAA9AD","#CD7F32","#CFCFCF"],"neutral-spectrum":["#8B8B8B","#A9A9A9","#C0C0C0","#D3D3D3","#E0E0E0"],"warm-sunset":["#FF6B6B","#FFA07A","#FFD700","#FF8C00","#FF4500"],"cool-ocean":["#00CED1","#20B2AA","#48D1CC","#40E0D0","#00FFFF"],"pride-confetti":["#FF0024","#FF8C00","#FFED00","#008026","#004DFF","#750787"],"love-bomb":["#FF6B6B","#FF85A1","#FFB3BA","#E8365D","#FF4F6E","#FFAEC9"],snow:["#FFFFFF","#F0F8FF","#E8F4F8"],"fourth-of-july":["#FF2200","#FFFFFF","#0033CC","#FFD700","#FF6633","#66AAFF"],custom:[this.config.customColor]};const e="particle-field"===this.config.experienceMode?Math.max(this.config.fieldParticleCount+100,300):Math.max(this.config.maxParticles+20,70);this.particlePool=new s(e),this.init()}init(){if(i&&this.config.disableOnMobile)return;this.createCanvas(),this.createToggleButton(),this.setupEventListeners();const t=sessionStorage.getItem("glitterBombActive");null!==t?this.isActive="true"===t:(this.isActive=this.config.enabledByDefault,sessionStorage.setItem("glitterBombActive",this.isActive.toString())),e&&(this.isActive=!1),this.updateButtonUI(),this.isActive&&("particle-field"===this.config.experienceMode&&(this.initializeParticleField(),this.isInitialized=!0),this.start())}updateButtonUI(){this.button&&(this.button.setAttribute("aria-pressed",this.isActive),this.button.textContent=this.isActive?this.config.disableButtonText:this.config.enableButtonText,this.applyButtonStyles(this.button,this.isActive))}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.className="glitter-bomb-canvas",this.canvas.setAttribute("aria-hidden","true"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d",{alpha:!0,willReadFrequently:!1,desynchronized:!0}),this.calculateCanvasSize()}getViewportHeight(){return window.visualViewport?window.visualViewport.height:window.innerHeight}calculateCanvasSize(){const t=window.innerWidth,e=this.getViewportHeight(),o=window.devicePixelRatio||1;this.logicalWidth=t,this.logicalHeight=e,this.canvasScale=i&&o>1?Math.min(1.5,o):o,this.canvas.width=t*this.canvasScale,this.canvas.height=e*this.canvasScale,this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.ctx&&this.ctx.scale(this.canvasScale,this.canvasScale)}handleResize(){const t=performance.now();this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),t-this.lastResizeTime<150&&(this.isResizing||(this.isResizing=!0,this.targetOpacity=.3,this.isFading=!0)),this.lastResizeTime=t,this.resizeDebounceTimer=setTimeout(()=>{this.calculateCanvasSize(),"particle-field"===this.config.experienceMode&&this.isActive&&this.initializeParticleField(),this.isResizing=!1,this.targetOpacity=1,this.isFading=!0},250)}updateCanvasOpacity(){if(!this.isFading)return;const t=this.targetOpacity-this.canvasOpacity;Math.abs(t)<.01?(this.canvasOpacity=this.targetOpacity,this.isFading=!1):this.canvasOpacity+=.05*t,this.canvas.style.opacity=this.canvasOpacity.toString()}getPaletteGradient(){const t="particle-field"===this.config.experienceMode?this.config.fieldColorPalette:this.config.colorPalette,e=this.colorPalettes[t];return"custom"===t?{start:this.config.customColor,end:this.config.customColor}:{start:e[0],end:e[e.length-1]}}createToggleButton(){const t=document.createElement("button");t.className="glitter-bomb-toggle position-"+this.config.buttonPosition,t.setAttribute("type","button");const e=document.createElement("div");e.className="glitter-bomb-sr-only",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.id="glitter-bomb-announcement",document.body.appendChild(e),this.button=t,this.srAnnouncement=e,document.body.appendChild(t)}applyButtonStyles(t,e){const i=e?this.config.disableButtonTextColor:this.config.enableButtonTextColor,o=e?this.config.disableButtonBgColor:this.config.enableButtonBgColor;let s=e?this.config.disableButtonGradientStart:this.config.enableButtonGradientStart,a=e?this.config.disableButtonGradientEnd:this.config.enableButtonGradientEnd;if(t.style.color=i,!s&&!a){const t=this.getPaletteGradient();s=t.start,a=t.end}t.style.background=s&&a?"linear-gradient(135deg, "+s+", "+a+")":o}setupEventListeners(){this.button.addEventListener("click",()=>this.toggle()),this.button.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.toggle())}),this.mouseMoveHandler=t=>{this.mouseX=t.clientX,this.mouseY=t.clientY,this.mouseInViewport=!0,this.isActive&&"sprinkle-trail"===this.config.experienceMode&&this.createParticle(t.clientX,t.clientY)},this.mouseLeaveHandler=()=>{this.mouseInViewport=!1},this.mouseEnterHandler=()=>{this.mouseInViewport=!0},this.touchMoveHandler=t=>{if(!this.isActive)return;const e=t.touches[0];this.mouseX=e.clientX,this.mouseY=e.clientY,this.mouseInViewport=!0,"sprinkle-trail"===this.config.experienceMode&&this.createParticle(e.clientX,e.clientY),this.lastTouchX=e.clientX,this.lastTouchY=e.clientY},this.touchStartHandler=t=>{if(!this.isActive)return;const e=t.touches[0];this.mouseX=e.clientX,this.mouseY=e.clientY,this.mouseInViewport=!0},this.touchEndHandler=()=>{this.mouseInViewport=!1},this.clickHandler=t=>{this.isActive&&"particle-field"===this.config.experienceMode&&this.config.fieldClickExplosion&&this.createExplosion(t.clientX,t.clientY)},this.touchTapHandler=t=>{if(this.isActive&&"particle-field"===this.config.experienceMode&&this.config.fieldClickExplosion){const e=t.changedTouches[0];this.createExplosion(e.clientX,e.clientY)}},this.resizeHandler=()=>{this.handleResize()},this.visibilityChangeHandler=()=>{this.isTabVisible=!document.hidden,this.isTabVisible&&this.isActive?this.animationFrameId||(this.lastFrameTime=performance.now(),this.lastUpdateTime=this.lastFrameTime,this.animate()):this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},window.visualViewport&&(this.visualViewportResizeHandler=()=>{this.handleResize()},window.visualViewport.addEventListener("resize",this.visualViewportResizeHandler)),document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseleave",this.mouseLeaveHandler),document.addEventListener("mouseenter",this.mouseEnterHandler),document.addEventListener("touchstart",this.touchStartHandler,{passive:!0}),document.addEventListener("touchmove",this.touchMoveHandler,{passive:!0}),document.addEventListener("touchend",this.touchEndHandler,{passive:!0}),document.addEventListener("touchcancel",this.touchEndHandler,{passive:!0}),document.addEventListener("click",this.clickHandler),document.addEventListener("touchend",this.touchTapHandler),window.addEventListener("resize",this.resizeHandler),document.addEventListener("visibilitychange",this.visibilityChangeHandler)}toggle(){this.isActive=!this.isActive,sessionStorage.setItem("glitterBombActive",this.isActive.toString()),this.updateButtonUI();const t=this.isActive?"Sparkle effects enabled. "+("particle-field"===this.config.experienceMode?"Magical glitter field activated.":"Particles will follow your cursor."):"Sparkle effects disabled.";this.srAnnouncement.textContent=t,this.isActive?("particle-field"===this.config.experienceMode&&(this.initializeParticleField(),this.isInitialized=!0),this.start()):this.stop()}start(){!this.animationFrameId&&this.isTabVisible&&(this.lastFrameTime=performance.now(),this.lastUpdateTime=this.lastFrameTime,this.animate())}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.particlePool.releaseAll(),this.rockets=[],this.isInitialized=!1,this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight)}initializeParticleField(){if(this.particlePool.releaseAll(),"fireworks"===this.config.fieldParticleStyle)return this.rockets=[],void(this.rocketLaunchTimer=0);const t=this.config.fieldParticleCount;for(let e=0;e<t;e++)this.createFieldParticle()}createFieldParticle(){const t=i?this.config.fieldParticleSizeMobile:this.config.fieldParticleSize,e=Math.random()*this.logicalWidth,o=Math.random()*this.logicalHeight,s=this.particlePool.acquire();if(s.x=e,s.y=o,s.homeX=e,s.homeY=o,s.vx=.5*(Math.random()-.5),s.vy=.5*(Math.random()-.5),s.baseSize=t*(.7+.6*Math.random()),s.size=s.baseSize,s.opacity=.6+.4*Math.random(),s.shimmerPhase=Math.random()*Math.PI*2,s.shimmerSpeed=.02+.03*Math.random(),s.rotation=Math.random()*Math.PI*2,s.rotationSpeed=.02*(Math.random()-.5),s.colorIndex=Math.random(),s.colorCycleSpeed=.001+.002*Math.random(),s.isExplosion=!1,s.explosionLife=0,s.driftAngle=Math.random()*Math.PI*2,s.driftSpeed=.2+.3*Math.random(),s.driftPhase=Math.random()*Math.PI*2,"pride-confetti"===this.config.fieldParticleStyle){const t=this.colorPalettes["pride-confetti"];s.color=t[Math.floor(Math.random()*t.length)];const e=.03+.06*Math.random();s.rotationSpeed=Math.random()<.5?e:-e}if("snow"===this.config.fieldParticleStyle){const t=i?this.config.fieldParticleSizeMobile:this.config.fieldParticleSize;s.baseSize=1.5+Math.pow(Math.random(),1.8)*(t-1.5),s.size=s.baseSize,s.fallSpeed=.4+s.baseSize/t*1.8,s.vy=s.fallSpeed*(.2+.5*Math.random()),s.vx=0,s.driftPhase=Math.random()*Math.PI*2,s.driftSpeed=.008+.015*Math.random(),s.driftAngle=.3+.5*Math.random(),s.baseOpacity=.35+.65*Math.random(),s.opacity=s.baseOpacity}}createExplosion(t,e){if("fireworks"===this.config.fieldParticleStyle){const i=this.config.fieldColorPalette,o=this.colorPalettes[i]||this.colorPalettes["fourth-of-july"],s={x:t,y:e,color:o[Math.floor(Math.random()*o.length)]};s.colorRgb=this.hexToRgb(s.color);const a=Math.min(Math.floor(this.config.fieldParticleCount/4),60);return void this.explodeRocket(s,2*a)}const o="snow"===this.config.fieldParticleStyle,s=i?this.config.fieldParticleSizeMobile:this.config.fieldParticleSize,a=this;if(this.particlePool.getActive().forEach(function(i){if(i.isExplosion)return;const s=i.x-t,a=i.y-e,n=Math.sqrt(s*s+a*a);if(n<250&&n>0){const t=8*(1-n/250),e=Math.atan2(a,s);i.vx+=Math.cos(e)*t*(o?.4:1),i.vy+=Math.sin(e)*t*(o?.4:1),o&&(i.vy-=.6*t)}}),o){const i=35;for(let o=0;o<i;o++){const i=-Math.random()*Math.PI,o=3+7*Math.random(),a=Math.max(1.5,1.5+Math.pow(Math.random(),1.8)*(s-1.5)),n=this.particlePool.acquire();n.x=t+30*(Math.random()-.5),n.y=e,n.homeX=t,n.homeY=e,n.vx=Math.cos(i)*o,n.vy=Math.sin(i)*o,n.baseSize=a,n.size=a,n.fallSpeed=.4+a/Math.max(s,1)*1.8,n.baseOpacity=.8+.2*Math.random(),n.opacity=n.baseOpacity,n.shimmerPhase=Math.random()*Math.PI*2,n.driftPhase=Math.random()*Math.PI*2,n.driftSpeed=.008+.015*Math.random(),n.driftAngle=.5,n.isExplosion=!0,n.explosionLife=1,n.colorIndex=0,n.colorCycleSpeed=0,n.rotation=0,n.rotationSpeed=0}}else{const i=40;for(let o=0;o<i;o++){const n=2*Math.PI*o/i,r=3+5*Math.random(),l=this.particlePool.acquire();if(l.x=t,l.y=e,l.homeX=t,l.homeY=e,l.vx=Math.cos(n)*r,l.vy=Math.sin(n)*r,l.baseSize=s*(1+.8*Math.random()),l.size=l.baseSize,l.opacity=1,l.shimmerPhase=Math.random()*Math.PI*2,l.shimmerSpeed=.05+.05*Math.random(),l.rotation=Math.random()*Math.PI*2,l.rotationSpeed=.1*(Math.random()-.5),l.colorIndex=Math.random(),l.colorCycleSpeed=.002,l.isExplosion=!0,l.explosionLife=1,l.driftAngle=0,l.driftSpeed=0,l.driftPhase=0,"pride-confetti"===a.config.fieldParticleStyle){const t=a.colorPalettes["pride-confetti"];l.color=t[Math.floor(Math.random()*t.length)]}}}}getParticleColor(t){if("pride-confetti"===this.config.fieldParticleStyle&&t&&t.color)return this.hexToRgba(t.color,t.opacity);const e="particle-field"===this.config.experienceMode?"love-bomb"===this.config.fieldParticleStyle?"love-bomb":this.config.fieldColorPalette:this.config.colorPalette;if("custom"===e){const e=t?t.opacity:this.config.particleOpacity;return this.hexToRgba(this.config.customColor,e)}const i=this.colorPalettes[e];if("particle-field"===this.config.experienceMode&&t){const e=i.length,o=Math.floor(t.colorIndex*e)%e,s=(o+1)%e,a=t.colorIndex*e%1,n=this.hexToRgb(i[o]),r=this.hexToRgb(i[s]);return"rgba("+Math.round(n.r+(r.r-n.r)*a)+", "+Math.round(n.g+(r.g-n.g)*a)+", "+Math.round(n.b+(r.b-n.b)*a)+", "+t.opacity+")"}{this.paletteIndex=(this.paletteIndex+.05)%i.length;const t=i[Math.floor(this.paletteIndex)];return this.hexToRgba(t,this.config.particleOpacity)}}hexToRgb(t){return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16)}}hexToRgba(t,e){const i=this.hexToRgb(t);return"rgba("+i.r+", "+i.g+", "+i.b+", "+e+")"}createParticle(t,e){const o=t-this.lastParticleX,s=e-this.lastParticleY;if(Math.sqrt(o*o+s*s)<(i?12:8))return;this.lastParticleX=t,this.lastParticleY=e;const a=this.particlePool.getActive();a.length>=this.config.maxParticles&&this.particlePool.release(a[0]);const n="compact"===this.config.displayBehavior,r=performance.now(),l=i?this.config.particleSizeMobile:this.config.particleSize,c=this.particlePool.acquire();c.x=t,c.y=e,c.size=l,c.color=this.getParticleColor(),c.opacity=this.config.particleOpacity,c.birthTime=r,c.maxLife=this.config.animationDuration,c.vx=n?0:2*(Math.random()-.5),c.vy=n?0:2*(Math.random()-.5)}updateSprinkleParticles(t){const e="compact"===this.config.displayBehavior,i=this.particlePool.getActive(),o=i.length;for(let s=i.length-1;s>=0;s--){const a=i[s],n=t-a.birthTime,r=Math.max(0,1-n/a.maxLife);e||(a.x+=a.vx,a.y+=a.vy);const l=o>1?(s+1)/o:1;a.opacity=this.config.particleOpacity*Math.min(r,l),(n>=a.maxLife||a.opacity<=.01||Math.abs(a.x)>2*this.logicalWidth||Math.abs(a.y)>2*this.logicalHeight)&&this.particlePool.release(a)}}updateFieldParticles(){const t=this.particlePool.getActive();for(let e=t.length-1;e>=0;e--){const i=t[e];if(("love-bomb"===this.config.fieldParticleStyle||"custom"!==this.config.fieldColorPalette&&"pride-confetti"!==this.config.fieldParticleStyle)&&(i.colorIndex=(i.colorIndex+i.colorCycleSpeed)%1),i.isExplosion){if(i.explosionLife-=.02,i.opacity=Math.max(0,i.explosionLife),i.x+=i.vx,i.y+=i.vy,i.vx*=.95,i.vy*=.95,i.explosionLife<=0){this.particlePool.release(i);continue}}else{i.driftPhase+=.015;const o=Math.cos(i.driftAngle+i.driftPhase)*i.driftSpeed,s=Math.sin(i.driftAngle+.7*i.driftPhase)*i.driftSpeed;if(i.vx+=.03*o,i.vy+=.03*s,this.mouseInViewport){const t=this.mouseX-i.x,e=this.mouseY-i.y,o=Math.sqrt(t*t+e*e),s=Math.max(this.logicalWidth,this.logicalHeight);if(o>0&&o<s){const a=o/s,n=Math.pow(1-a,3)*this.config.fieldMouseAttraction*.08;i.vx+=t/o*n,i.vy+=e/o*n}}else{const t=i.homeX,e=i.homeY,o=t-i.x,s=e-i.y,a=Math.sqrt(o*o+s*s);if(a>1){const t=.002;i.vx+=o/a*t*a*.05,i.vy+=s/a*t*a*.05}}for(let o=e+1;o<t.length;o++){const e=t[o];if(e.isExplosion)continue;const s=e.x-i.x,a=e.y-i.y,n=Math.sqrt(s*s+a*a);if(n>0&&n<30){const t=(30-n)/30*this.config.fieldSpreadStrength*.05;i.vx-=s/n*t,i.vy-=a/n*t}}}i.x+=i.vx,i.y+=i.vy,i.isExplosion||(i.vx*=.95,i.vy*=.95),i.x<0&&(i.x=this.logicalWidth),i.x>this.logicalWidth&&(i.x=0),i.y<0&&(i.y=this.logicalHeight),i.y>this.logicalHeight&&(i.y=0),i.shimmerPhase+=i.shimmerSpeed;const o=(Math.sin(i.shimmerPhase)+1)/2;i.size=i.baseSize*(.7+.3*o),i.rotation+=i.rotationSpeed}}updateFireworksParticles(){const t=this.config.fieldColorPalette,e=this.colorPalettes[t]||this.colorPalettes["fourth-of-july"],i=Math.max(25,Math.round(180-155*this.config.fieldMouseAttraction)),o=Math.min(Math.floor(this.config.fieldParticleCount/4),60);this.rocketLaunchTimer++,this.rocketLaunchTimer>=i&&this.rockets.length<8&&(this.launchRocket(e),Math.random()<.25&&this.launchRocket(e),this.rocketLaunchTimer=0);for(let t=this.rockets.length-1;t>=0;t--){const e=this.rockets[t];e.vy+=.09,e.x+=e.vx,e.y+=e.vy,e.vy>=-.3?(this.explodeRocket(e,o),this.rockets.splice(t,1)):e.y<-100&&this.rockets.splice(t,1)}const s=this.particlePool.getActive();for(let t=s.length-1;t>=0;t--){const e=s[t];e.vy+=.1,e.vx*=.99,e.x+=e.vx,e.y+=e.vy,e.explosionLife-=.014,e.opacity=Math.max(0,e.explosionLife),e.size=e.baseSize*Math.max(0,e.explosionLife),(e.explosionLife<=0||e.y>this.logicalHeight+50)&&this.particlePool.release(e)}}launchRocket(t){const e=t[Math.floor(Math.random()*t.length)],i=9+6*Math.random();this.rockets.push({x:Math.random()*this.logicalWidth,y:this.logicalHeight*(.45+.45*Math.random()),vx:1.5*(Math.random()-.5),vy:-i,color:e,colorRgb:this.hexToRgb(e)})}explodeRocket(t,e){const o=i?this.config.fieldParticleSizeMobile:this.config.fieldParticleSize,s=t.colorRgb;for(let i=0;i<e;i++){const a=2*Math.PI*i/e+.4*(Math.random()-.5),n=1.5+4.5*Math.random(),r=this.particlePool.acquire();r.x=t.x,r.y=t.y,r.homeX=t.x,r.homeY=t.y,r.vx=Math.cos(a)*n,r.vy=Math.sin(a)*n-.8,r.baseSize=o*(.3+.5*Math.random()),r.size=r.baseSize,r.color=`rgba(${s.r}, ${s.g}, ${s.b}, 1)`,r.opacity=1,r.isExplosion=!0,r.explosionLife=.6+.6*Math.random(),r.colorIndex=0,r.colorCycleSpeed=0,r.rotation=0,r.rotationSpeed=0,r.driftAngle=0,r.driftSpeed=0,r.driftPhase=0}}drawFireworksParticles(){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.rockets.forEach(t=>{const e=t.colorRgb,i=t.x-18*t.vx,o=t.y-18*t.vy,s=this.ctx.createLinearGradient(t.x,t.y,i,o);s.addColorStop(0,`rgba(${e.r}, ${e.g}, ${e.b}, 0.9)`),s.addColorStop(.5,"rgba(255, 220, 120, 0.5)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i,o),this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2.5,0,2*Math.PI),this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fill()}),this.particlePool.getActive().forEach(t=>{if(t.opacity<=0||t.size<=0)return;const e=t.color.replace(/[\d.]+\)$/,t.opacity+")"),i=t.color.replace(/[\d.]+\)$/,.25*t.opacity+")");this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2.5*t.size,0,2*Math.PI),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fillStyle=e,this.ctx.fill()})}updateSnowParticles(){const t=this.config.fieldMouseAttraction,e=this.particlePool.getActive();for(let i=e.length-1;i>=0;i--){const o=e[i];if(o.isExplosion){o.vy+=.25,o.vx*=.98,o.x+=o.vx,o.y+=o.vy,o.explosionLife-=.016,o.opacity=Math.max(0,o.explosionLife*(o.baseOpacity||.9)),o.explosionLife<=0&&this.particlePool.release(o);continue}if(o.vy<o.fallSpeed&&(o.vy+=.04),o.driftPhase+=o.driftSpeed,o.vx=Math.sin(o.driftPhase)*o.driftAngle,t>0&&this.mouseInViewport){const e=o.x-this.mouseX,i=o.y-this.mouseY,s=Math.sqrt(e*e+i*i);if(s<120&&s>0){const i=(1-s/120)*t*1.5;o.vx+=e/s*i*.5,o.vy-=.4*i}}o.x+=o.vx,o.y+=o.vy,o.x<-o.size&&(o.x=this.logicalWidth+o.size),o.x>this.logicalWidth+o.size&&(o.x=-o.size),o.y>this.logicalHeight+o.size&&(o.x=Math.random()*this.logicalWidth,o.y=-o.size-30*Math.random(),o.vy=o.fallSpeed*(.2+.3*Math.random())),o.shimmerPhase+=.018;const s=(Math.sin(o.shimmerPhase)+1)/2;o.opacity=o.baseOpacity*(.75+.25*s)}}drawSprinkleParticles(){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const t="emoji"===this.config.sprinkleStyle,e=this.config.sprinkleEmoji||"✨";this.particlePool.getActive().forEach(i=>{t?(this.ctx.save(),this.ctx.globalAlpha=i.opacity,this.ctx.font=`${Math.round(2*i.size)}px serif`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e,i.x,i.y),this.ctx.restore(),this.ctx.globalAlpha=1):(this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,2*Math.PI),this.ctx.fillStyle=i.color.replace(/[\d.]+\)$/g,i.opacity+")"),this.ctx.fill())})}drawFieldParticles(){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const t=this.config.fieldParticleStyle;this.particlePool.getActive().forEach(e=>{if("pride-confetti"===t)this.drawPrideConfetti(e);else if("love-bomb"===t)this.drawLoveBombHeart(e);else if("snow"===t)this.drawSnowParticle(e);else{this.ctx.save(),this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation);const t=this.getParticleColor(e),i=5;for(let o=0;o<i;o++){this.ctx.beginPath();const s=2*Math.PI*o/i,a=1.5*e.size;this.ctx.moveTo(0,0),this.ctx.lineTo(Math.cos(s)*a,Math.sin(s)*a),this.ctx.lineTo(Math.cos(s+.1)*(.5*a),Math.sin(s+.1)*(.5*a)),this.ctx.closePath(),this.ctx.fillStyle=t,this.ctx.fill()}this.ctx.beginPath(),this.ctx.arc(0,0,.5*e.size,0,2*Math.PI),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.restore()}})}drawLoveBombHeart(t){const e=t.size,i=this.getParticleColor(t);this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.beginPath(),this.ctx.moveTo(0,.5*-e),this.ctx.bezierCurveTo(.5*e,1.1*-e,1.2*e,.3*-e,0,.7*e),this.ctx.bezierCurveTo(1.2*-e,.3*-e,.5*-e,1.1*-e,0,.5*-e),this.ctx.closePath(),this.ctx.globalAlpha=t.opacity,this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.restore(),this.ctx.globalAlpha=1}drawPrideConfetti(t){const e=.5*t.size,i=1*t.size;this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.globalAlpha=t.opacity,this.ctx.fillStyle=t.color,this.ctx.fillRect(-i,-e,2*i,2*e),this.ctx.restore(),this.ctx.globalAlpha=1}drawSnowParticle(t){const e=t.x,i=t.y,o=t.size,s=this.ctx.createRadialGradient(e,i,0,e,i,o);s.addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(.45,"rgba(240, 248, 255, 0.85)"),s.addColorStop(1,"rgba(200, 228, 255, 0)"),this.ctx.save(),this.ctx.globalAlpha=t.opacity,this.ctx.beginPath(),this.ctx.arc(e,i,o,0,2*Math.PI),this.ctx.fillStyle=s,this.ctx.fill(),this.ctx.restore()}animate(){if(!this.isTabVisible||!this.isActive)return void(this.animationFrameId=null);const t=performance.now(),e=t-this.lastUpdateTime;e>=o?(this.updateCanvasOpacity(),"sprinkle-trail"===this.config.experienceMode?(this.updateSprinkleParticles(t),this.drawSprinkleParticles()):"snow"===this.config.fieldParticleStyle?(this.updateSnowParticles(),this.drawFieldParticles()):"fireworks"===this.config.fieldParticleStyle?(this.updateFireworksParticles(),this.drawFireworksParticles()):(this.updateFieldParticles(),this.drawFieldParticles()),this.lastUpdateTime=t-e%o):"sprinkle-trail"===this.config.experienceMode?this.drawSprinkleParticles():"fireworks"===this.config.fieldParticleStyle?this.drawFireworksParticles():this.drawFieldParticles(),this.animationFrameId=requestAnimationFrame(()=>this.animate())}destroy(){this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseleave",this.mouseLeaveHandler),document.removeEventListener("mouseenter",this.mouseEnterHandler),document.removeEventListener("touchstart",this.touchStartHandler),document.removeEventListener("touchmove",this.touchMoveHandler),document.removeEventListener("touchend",this.touchEndHandler),document.removeEventListener("touchcancel",this.touchEndHandler),document.removeEventListener("click",this.clickHandler),document.removeEventListener("touchend",this.touchTapHandler),window.removeEventListener("resize",this.resizeHandler),document.removeEventListener("visibilitychange",this.visibilityChangeHandler),window.visualViewport&&this.visualViewportResizeHandler&&window.visualViewport.removeEventListener("resize",this.visualViewportResizeHandler),this.stop(),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.button&&this.button.parentNode&&this.button.parentNode.removeChild(this.button),this.srAnnouncement&&this.srAnnouncement.parentNode&&this.srAnnouncement.parentNode.removeChild(this.srAnnouncement)}}function n(){document.querySelectorAll(".wp-block-glitter-bomb-glitter-bomb").forEach(function(t){t.glitterBombInstance||(t.glitterBombInstance=new a(t))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.addEventListener("beforeunload",function(){document.querySelectorAll(".wp-block-glitter-bomb-glitter-bomb").forEach(function(t){t.glitterBombInstance&&t.glitterBombInstance.destroy()})})}();